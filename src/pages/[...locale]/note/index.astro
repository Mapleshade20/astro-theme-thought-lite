---
import { i18n } from "astro:config/client";
import { actions } from "astro:actions";
import Base from "$layouts/Base.astro";
import Note from "$components/note/Note.svelte";
import Icon from "$components/Icon.astro";
import i18nit from "$i18n";

export const prerender = false;

const { locale = i18n!.defaultLocale } = Astro.params;

const t = i18nit(locale);

const size = 20;
const page = Number(Astro.url.searchParams.get("page")) || 1;
const series = Astro.url.searchParams.get("series");
const tags = Astro.url.searchParams.getAll("tag");

const { data, error } = await Astro.callAction(actions.note.list, { locale, size, page, series, tags });
if (error) {
	switch (error.code) {
		default:
			return Astro.redirect("/500", 302);
	}
}

const { notes, pages, page: index, series_list, tag_list } = data;
---

<Base title={t("navigation.note")} {locale}>
	<main class="flex flex-col grow">
		<Note client:load {locale} {notes} {pages} page={index} {size} {series_list} {tag_list} {series} {tags}>
			<Icon name="lucide:flag-triangle-right" slot="top" />
			<Icon name="lucide:siren" title={t("sensitive.icon")} slot="sensitive" />
			<Icon name="lucide:arrow-left" slot="left" />
			<Icon name="lucide:arrow-right" slot="right" />
			<Icon name="lucide:ellipsis" slot="dots" />
		</Note>
	</main>
</Base>
